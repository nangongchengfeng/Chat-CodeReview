# Chat-CodeReview(Gitlab)

>   ChatGPT ã¯ GitLab ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¾ã™ã€‚ 

ç¿»è¨³ç‰ˆ: [ENGLISH](https://github.com/nangongchengfeng/Chat-CodeReview/blob/main/README.md) | [ä¸­æ–‡ç®€ä½“](https://github.com/nangongchengfeng/Chat-CodeReview/blob/main/README.zh-CN.md) | [ä¸­æ–‡ç¹é«”](https://github.com/nangongchengfeng/Chat-CodeReview/blob/main/README.zh-TW.md) | [í•œêµ­ì–´](https://github.com/nangongchengfeng/Chat-CodeReview/blob/main/README.ko.md) | [æ—¥æœ¬èª](https://github.com/nangongchengfeng/Chat-CodeReview/blob/main/README.ja.md) 

## ç‰¹å¾´

 **ChatGPTã¯GitLabã¨çµ±åˆã—ã€è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ç›£æŸ»ã‚’è¡Œã„ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºãƒãƒ¼ãƒ ã«åŠ¹ç‡çš„ã§ã‚¹ãƒãƒ¼ãƒˆãªã‚³ãƒ¼ãƒ‰ç›£æŸ»ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚** 

> 1. è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªå¿œç­”ï¼šGitLabã®Webhookæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆã€ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã‚¿ã‚°ä½œæˆãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è‡ªå‹•çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆãŒã‚ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ã¯å³åº§ã«å¿œç­”ã—ã€è‡ªå‹•çš„ã«ç›£æŸ»ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™ã€‚æ‰‹å‹•ã§å¹²æ¸‰ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
> 2. GitLab API ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®æ´»ç”¨ï¼šGitLabã®APIã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¨çµ±åˆã™ã‚‹ã“ã¨ã§ã€å°†æ¥çš„ãªæ©Ÿèƒ½ã®æ‹¡å¼µã‚„æ‹¡å……ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚ã“ã®çµ±åˆæ–¹æ³•ã«ã‚ˆã‚Šã€GitLabã¨ã®ã‚„ã‚Šå–ã‚ŠãŒæŸ”è»Ÿã«ãªã‚Šã€ã‚ˆã‚Šå¤šæ§˜ãªã‚«ã‚¹ã‚¿ãƒ ç›£æŸ»è¦ä»¶ã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚
> 3. å…¨è‡ªå‹•ã®ã‚³ãƒ¼ãƒ‰ç›£æŸ»ï¼šChatGPTã¯ã€GitLabã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ç›£æŸ»ã—ã€ã‚³ãƒŸãƒƒãƒˆï¼ˆpushï¼‰ã€ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆåˆæµãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ã€ã‚¿ã‚°ï¼ˆã‚¿ã‚°ä½œæˆï¼‰ãªã©ã€3ã¤ã®ã‚³ãƒ¼ãƒ‰æå‡ºæ–¹æ³•ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã®æå‡ºã‚„ã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ã«é–¢ã‚ã‚‰ãšã€ã‚·ã‚¹ãƒ†ãƒ ã¯è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã€ç›£æŸ»ã‚³ãƒ¡ãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚
> 4. ãƒªãƒˆãƒ©ã‚¤ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å•é¡Œã‚„ãã®ä»–ã®å•é¡Œã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ãƒªãƒˆãƒ©ã‚¤ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å•é¡Œã«ã‚ˆã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ãªã‹ã£ãŸå ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã¯è‡ªå‹•çš„ã«ãƒªãƒˆãƒ©ã‚¤ã‚’è¡Œã„ã€ç›£æŸ»ãƒ—ãƒ­ã‚»ã‚¹ã®ä¿¡é ¼æ€§ã¨å®‰å®šæ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚

## å®¡è®¡åŸç†

![1689647943933](images/1689647943933.png)

 **é”æˆã™ã¹ãæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š** 

> 1. GitLabã®Webhookã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ï¼šGitLabã¯Webhookã‚’è¨­å®šã§ãã€ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆã‚„ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸéš›ã«é€šçŸ¥ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆã‚„ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã€GitLabã¯äº‹å‰ã«è¨­å®šã•ã‚ŒãŸURLã«å¯¾ã—ã¦POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€é–¢é€£ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã¾ã™ã€‚
> 2. Diffå†…å®¹ã®è§£æã¨ChatGPTã¸ã®é€ä¿¡ï¼šGitLabãŒWebhookã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã™ã‚‹ã¨ã€Diffå†…å®¹ã‚’è§£æã§ãã¾ã™ã€‚ã“ã‚Œã¯æ–°ã—ãæå‡ºã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¨æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¨ã®å·®åˆ†ã§ã™ã€‚ãã—ã¦ã€ã“ã‚Œã‚‰ã®å·®åˆ†ã‚’ChatGPTã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é€ä¿¡ã—ã€ChatGPTãŒã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å†…å®¹ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
> 3. ChatGPTã®å‡¦ç†ã¨çµæœã®è¿”ä¿¡ï¼šChatGPTã¯å¼·åŠ›ãªè‡ªç„¶è¨€èªå‡¦ç†ãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚Šã€è‡ªç„¶è¨€èªãƒ†ã‚­ã‚¹ãƒˆã‚’ç†è§£ã—ã€å‡¦ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ChatGPTãŒDiffå†…å®¹ã‚’å—ä¿¡ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´å†…å®¹ã‚’è§£æã—ã€å•é¡Œç‚¹ã€è„†å¼±æ€§ã€ã¾ãŸã¯æœ€é©åŒ–ã®ææ¡ˆã«å¯¾ã—ã¦åˆ†æã¨å›ç­”ã‚’è¡Œã„ã¾ã™ã€‚ChatGPTã¯å‡¦ç†ã•ã‚ŒãŸçµæœã‚’Webhookã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãŸGitLabã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«è¿”ä¿¡ã—ã¾ã™ã€‚
> 4. ChatGPTãŒå‡¦ç†ã—ãŸçµæœã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§è¡¨ç¤ºï¼šGitLabã¯ChatGPTã‹ã‚‰ã®å‡¦ç†çµæœã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’å¯¾å¿œã™ã‚‹ã‚³ãƒŸãƒƒãƒˆã‚„ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½åŠ ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®æå‡ºè€…ã‚„ä»–ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¯ChatGPTã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’ç¢ºèªã—ã€ææ¡ˆã«åŸºã¥ã„ã¦é©åˆ‡ãªæ”¹å–„ã‚„ä¿®æ­£ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

 GitLabã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ChatGPTã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ ã¯æ½œåœ¨çš„ãªå•é¡Œã‚„è„†å¼±æ€§ã€æ”¹å–„ã®æ©Ÿä¼šã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚ï¼ˆä»¥ä¸Šã€å‚è€ƒã¾ã§ã«ï¼‰ã€‚ 





## prompt

### ä¸Šç´šãƒªãƒ¼ãƒ€ãƒ¼

```python
    messages = [
        {"role": "system",
         "content": "ç§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æä¾›ã•ã‚Œã‚‹GitLabã®ã‚³ãƒŸãƒƒãƒˆã‚³ãƒ¼ãƒ‰å¤‰æ›´ã¯ã€å¤‰æ›´ã®ã‚¹ã‚³ã‚¢ã‚’ã€Œå¤‰æ›´è©•ä¾¡ï¼šå®Ÿéš›ã®ã‚¹ã‚³ã‚¢ã€ã®å½¢å¼ã§ç¤ºã—ã€ã‚¹ã‚³ã‚¢ã®ç¯„å›²ã¯0ã€œ100ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¾ã™ã€‚å‡ºåŠ›å½¢å¼ã¯ã€å³æ ¼ãªè¨€è‘‰ã§ã€å•é¡Œã‚’æŒ‡æ‘˜ã—ã€å¿…è¦ãªå ´åˆã¯ç›´æ¥ä¿®æ­£å†…å®¹ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å†…å®¹ã¯å³æ ¼ãªMarkdownå½¢å¼ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"
         },
        {"role": "user",
         "content": f"è¯·reviewè¿™éƒ¨åˆ†ä»£ç å˜æ›´{content}",
         },
    ]
```

###  ãƒ„ãƒ³ãƒ‡ãƒ¬å°‘å¥³ ğŸ‘§

```python
{
    "role": "system",
    "content": "ã‚ãªãŸã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«é•·ã‘ãŸå¤©æ‰ã®å°‘å¥³ã§ã€é«˜æ…¢ã§å‚²æ…¢ãªæ€§æ ¼ã‚’æŒã¡ã€å‰è¼©ã®ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’å¯©æŸ»ã™ã‚‹è²¬ä»»ãŒã‚ã‚Šã¾ã™ã€‚è‹¥ã€…ã—ã„æ…‹åº¦ã¨å…ƒæ°—ãªæ–¹æ³•ã§å•é¡Œã‚’æŒ‡æ‘˜ã—ã¾ã™ã€‚Markdownå½¢å¼ã‚’ä½¿ç”¨ã—ã¦ã€çµµæ–‡å­—ã‚‚ä½¿ã£ã¦æ§‹ã„ã¾ã›ã‚“ã€‚"
}
```

## ç’°å¢ƒå¤‰æ•°

> -  gitlab_server_url: Gitlabã‚µãƒ¼ãƒãƒ¼ã®URLã‚¢ãƒ‰ãƒ¬ã‚¹
> -  gitlab_private_token: Gitlab APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒˆãƒ¼ã‚¯ãƒ³
> -  openai_api_key: OpenAIã®APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®APIã‚­ãƒ¼



##  GitLabã®Webhookï¼ˆã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ï¼‰ 

GitLabã®Webhookã¯ã€ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸéš›ã«GitLabã‹ã‚‰æŒ‡å®šã—ãŸURLã«å¯¾ã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã€é–¢é€£ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æ¸¡ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã‚«ã‚¹ã‚¿ãƒ ã®æ“ä½œã‚„å¿œç­”ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Webhookã¯ã€ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆã€ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã‚¿ã‚°ã®ä½œæˆã€ãƒ–ãƒ©ãƒ³ãƒæ“ä½œãªã©ã€ã•ã¾ã–ã¾ãªã‚¤ãƒ™ãƒ³ãƒˆã‚’GitLabã§ç›£è¦–ã—ã€å¿œç­”ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Webhookã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ã•ã¾ã–ã¾ãªè‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯ã‚„çµ±åˆã€ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³/ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼ï¼ˆCI/CDï¼‰ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã€GitLabã®Webhookã®ä¸»ãªç‰¹å¾´ã¨ç”¨é€”ã§ã™ï¼š

> 1. ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ï¼šGitLabã§Webhookã‚’è¨­å®šã—ã€æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒŸãƒƒãƒˆã€ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã©ï¼‰ãŒç™ºç”Ÿã—ãŸéš›ã«ã€GitLabãŒè‡ªå‹•çš„ã«Webhookã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚
> 2. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼šã‚¤ãƒ™ãƒ³ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã¨ã€GitLabã¯äº‹å‰ã«è¨­å®šã—ãŸURLã«å¯¾ã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚é€šå¸¸ã¯POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚Šã€é–¢é€£ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§å«ã‚“ã§ã„ã¾ã™ã€‚
> 3. ã‚«ã‚¹ã‚¿ãƒ æ“ä½œï¼šWebhookãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€å—ã‘å–ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—å‡¦ç†ã—ã€ã‚«ã‚¹ã‚¿ãƒ ã®æ“ä½œï¼ˆè‡ªå‹•ãƒ“ãƒ«ãƒ‰ã€è‡ªå‹•ãƒ†ã‚¹ãƒˆã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãªã©ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 4. ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ±åˆï¼šWebhookã«ã‚ˆã‚Šã€GitLabã¯ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒ„ãƒ¼ãƒ«ã¨ã®çµ±åˆãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•åŒæœŸã‚’ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«è¡Œã£ãŸã‚Šã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«è‡ªå‹•é€šçŸ¥ã‚’é€ã£ãŸã‚Šã€ã‚¿ã‚¹ã‚¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’è‡ªå‹•æ›´æ–°ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
> 5. æŸ”è»Ÿãªè¨­å®šï¼šGitLabã®Webhookã«ã¯è±Šå¯Œãªè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€ç›£è¦–ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ãŸã‚Šã€ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ã‚’è¨­å®šã—ãŸã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å†…å®¹ã‚„å½¢å¼ã‚’å®šç¾©ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![1689651530556](images/1689651530556.png)

![1689651554862](images/1689651554862.png)

------

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒƒã‚·ãƒ¥ï¼‰

**Request URL:** POST http://192.168.96.19:5000/git/webhook 200

**Trigger:** Push Hook

**Elapsed time:** 0.01 sec

**Request time:** åˆšåˆš

------

##### Request headers:

```
Content-Type: application/jsonX-Gitlab-Event: Push HookX-Gitlab-Token: asdhiqbryuwfqodwgeayrgfbsifbd
```

##### Request body:

```
{
  "object_kind": "push",
  "event_name": "push",
  "before": "95790bf891e76fee5e1747ab589903a6a1f80f22",
  "after": "da1560886d4f094c3e6c9ef40349f7d38b5d27d7",
  "ref": "refs/heads/master",
  "checkout_sha": "da1560886d4f094c3e6c9ef40349f7d38b5d27d7",
  "message": "Hello World",
  "user_id": 4,
  "user_name": "John Smith",
  "user_email": "john@example.com",
  "user_avatar": "https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80",
  "project_id": 15,
  "project": {
    "id": 15,
    "name": "gitlab",
    "description": "",
    "web_url": "http://test.example.com/gitlab/gitlab",
    "avatar_url": "https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80",
    "git_ssh_url": "git@test.example.com:gitlab/gitlab.git",
    "git_http_url": "http://test.example.com/gitlab/gitlab.git",
    "namespace": "gitlab",
    "visibility_level": 0,
    "path_with_namespace": "gitlab/gitlab",
    "default_branch": "master"
  },
  "commits": [
    {
      "id": "c5feabde2d8cd023215af4d2ceeb7a64839fc428",
      "message": "Add simple search to projects in public area",
      "timestamp": "2013-05-13T18:18:08+00:00",
      "url": "https://test.example.com/gitlab/gitlab/-/commit/c5feabde2d8cd023215af4d2ceeb7a64839fc428",
      "author": {
        "name": "Test User",
        "email": "test@example.com"
      }
    }
  ],
  "total_commits_count": 1,
  "push_options": {
    "ci": {
      "skip": true
    }
  }
}
```

##### Response headers:

```
Server: Werkzeug/2.3.6 Python/3.8.0Date: Tue, 18 Jul 2023 03:39:51 GMTContent-Type: application/jsonContent-Length: 26Connection: close
```

##### Response body:

```
{
  "status": "success"
}
```



## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹

### 1. ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

```python
git clone https://github.com/nangongchengfeng/chat-review.git
```

### 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚

![1689663745702](images/1689663745702.png)

```python
python deal_package.py
```

### 3ã€æ§‹æˆã‚’æ›´æ–°ã™ã‚‹

**config/config.py**

```python

"""
è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥ä»apolloé…ç½®ä¸­å¿ƒè·å–é…ç½®çš„ï¼Œ
å¦‚æœæ²¡æœ‰apolloé…ç½®ä¸­å¿ƒï¼Œå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œé…ç½®
"""

WEBHOOK_VERIFY_TOKEN = "asdhiqbryuwfqodwgeayrgfbsifbd"
gitlab_server_url = gitlab_server_url
gitlab_private_token = gitlab_private_token
openai_api_key = openai_api_key

```

### 4ã€app.pyãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹

```python
ç®€å•
nohup python3 app.py & 
```

### 5ã€Gitlab è¨­å®š Webhook

```python
http://192.168.96.19:5000/git/webhook 
å®Ÿè¡Œãƒã‚·ãƒ³ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã—ãŸã‚Šã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å¤‰æ›´ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
http://gitlab.ownit.top/git/webhook 
```



![1689651530556](images/1689651530556.png)



## é›£ç—…

### diffå‡¦ç†

![1689661104194](images/1689661104194.png)

#### æ–¹æ³•1  ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ï¼‰ 

â€‹		1ã€diffã®å†…å®¹ã‚’ã™ã¹ã¦ChatGPTã«æ¸¡ã—ã¦å‡¦ç†ã‚’è¡Œã„ã¾ã™ï¼ˆè¿½åŠ è¡Œã€å‰Šé™¤è¡Œã‚’å«ã‚€ï¼‰ã€‚

åˆ©ç‚¹ï¼šç°¡å˜ã§è¿…é€Ÿã§ã™ã€‚

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼šå†…å®¹ãŒé•·ã™ãã‚‹å ´åˆã€ChatGPTã®å‡¦ç†ã«å¤±æ•—ã—ã€ã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã‚„è«–ç†ã®æ•´åˆæ€§ãŒå¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚



#### æ–¹æ³•2 ( æ¨å¥¨æ–¹æ³•ï¼‰ 

â€‹		2ã€diffã®å†…å®¹ã‚’å‡¦ç†ã—ã€å‰Šé™¤è¡Œã¨+è¨˜å·ã®ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

åˆ©ç‚¹ï¼šç°¡å˜ã§è¿…é€Ÿã§ã‚ã‚Šã€ä¸€å®šã®é•·ã•ã‚’ç¯€ç´„ã§ãã¾ã™ã€‚

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼šå†…å®¹ãŒé•·ã™ãã‚‹å ´åˆã€ChatGPTã®å‡¦ç†ã«å¤±æ•—ã—ã€ã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã‚„è«–ç†ã®æ•´åˆæ€§ãŒå¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```python
def filter_diff_content(diff_content):
    filtered_content = re.sub(r'(^-.*\n)|(^@@.*\n)', '', diff_content, flags=re.MULTILINE)
    processed_code = '\n'.join([line[1:] if line.startswith('+') else line for line in filtered_content.split('\n')])
    return processed_code
```

![1689661743140](images/1689661743140.png)



#### æ–¹æ³•3 ( è¤‡é›‘ãªæ–¹æ³•ï¼‰- æœªèª¿æ•´ã€ã‚³ãƒ¼ãƒ‰ã¯å®Œæˆã—ã¦ã„ã¾ã™ 

â€‹		3ã€diffã®å†…å®¹ã‚’å‡¦ç†ã—ã€å‰Šé™¤è¡Œã¨+è¨˜å·ã®ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ä¿®æ­£ã•ã‚ŒãŸå…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€JavaParserã‚’ä½¿ç”¨ã—ã¦è§£æã—ã¾ã™ã€‚å¯¾å¿œã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’å–å¾—ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

åˆ©ç‚¹ï¼šé•·ã•ã‚’ç¯€ç´„ã§ãã€ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Œäº†ã—ã€ãƒ­ã‚¸ãƒƒã‚¯ãŒå¤šå°‘æ•´åˆã—ã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼šéå¸¸ã«æ‰‹é–“ãŒã‹ã‹ã‚Šã€é¢å€’ã§ã€Javaã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

```json
[{
	'code': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
	'name': 'SettlementDetailController'
}, {
	'code': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
	'name': 'queryRecord'
}, {
	'code': 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
	'name': 'populateBatchItemVO'
}]
```



## ãƒ‡ãƒ¢

![1689663598079](images/1689663598079.png)



## åŠ©ã‘ã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚µãƒãƒ¼ãƒˆã¨ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸ãˆã¦ãã‚ŒãŸ [ anc95  å°å®‰å¤§ä½¬](https://github.com/anc95) ã«æ„Ÿè¬ã—ã¾ã™

 https://github.com/anc95/ChatGPT-CodeReview.git

 ![Avatar](images/13167934.jpg) 



